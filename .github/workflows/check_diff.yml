name: Check changed apps/packages

on:
  push:
    branches: [ main ]

jobs:
  detect-changes:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Get changed files (tj-actions/changed-files)
        uses: tj-actions/changed-files@v34
        id: changed
        with:
          files: |
            apps/**
            packages/**

      - name: List changed directories
        if: steps.changed.outputs.any_changed == 'true'
        run: |
          # 1. 변경된 모든 파일 목록을 가져옵니다.
          # 2. 각 경로에서 두 번째 슬래시까지의 경로(ex: apps/a)만 잘라냅니다.
          # 3. 중복을 제거합니다.
          changed_dirs=$(echo "${{ steps.changed.outputs.all_changed_files }}" | tr ' ' '\n' | cut -d'/' -f1,2 | sort -u)
          
          echo "--- 변경된 앱/패키지 목록 ---"
          echo "$changed_dirs"
          
          # 나중에 다른 스텝에서 쓸 수 있게 환경 변수나 출력값으로 저장할 수도 있습니다.
          {
            echo "CHANGED_DIRS<<EOF"
            echo "$CHANGED_DIRS"
            echo "EOF"
          } >> "$GITHUB_ENV"